---
# tasks file for tom8.install
- name: create the group 
  group:
    name: tomcat
    state: present

- name: create the user
  user:
    name: tomcat
    shell: /bin/bash
    group: tomcat
    comment: tomuser
    home: /opt/tomcat
    state: present
- name: create the directory
  file:
    path: /opt/tomcat
    state: directory
    mode: 0755
- name:  unarchive
  unarchive:
    src: http://apache.mirrors.ionfish.org/tomcat/tomcat-8/v8.0.48/bin/apache-tomcat-8.0.48.tar.gz
    dest: /opt/tomcat
    remote_src: yes
- name:  make the tomcat user the owner of the work, temp, and logs directories
  file:
    path: /opt/tomcat/apache-tomcat-8.0.48/{{ item }}
    owner: tomcat
    group: tomcat
    recurse: true
  with_items:
    - work
    - temp
    - logs
    - webapps

- name: the tomcat user write access to the conf directory, and read access to the files
  file:
    path: /opt/tomcat/apache-tomcat-8.0.48
    state: directory
    owner: tomcat
    group: tomcat 
    mode: 0755
    recurse: true

- name: the tomcat user write access to the conf directory, and read access to the files
  file:
    path: /opt/tomcat/apache-tomcat-8.0.48/conf
    state: directory
    mode: "g+r"
    recurse: true
- name: the tomcat user write access to the conf directory, and read access to the files
  file:
    path: /opt/tomcat/apache-tomcat-8.0.48/conf
    state: directory
    mode: "g+x"
    recurse: true
- name: the tomcat user write access to the conf directory, and read access to the files
  file:
    path: /opt/tomcat/apache-tomcat-8.0.48/conf
    state: directory
    mode: "g+w"
    recurse: true

- name: create the tomcat.service RedHat
  template: 
    src: tamplates/tomcat.service.j2
    dest: /etc/systemd/system/tomcat.service
  notify: tomcatrestart
  when: ansible_os_family == "RedHat"

- name: create the tomcat.conf  Debian
  template:
    src: tamplates/tomcat.conf.j2
    dest: /etc/init/tomcat.conf
  notify: tomcatrestart
  when: ansible_os_family == "Debian"

- name: create the tomcat-user-xml  
  template:
    src: tamplates/tomcat-users.xml.j2
    dest: /opt/tomcat/apache-tomcat-8.0.48/conf/tomcat-users.xml
  notify: tomcatrestart
 
 

